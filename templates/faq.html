<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ问答管理</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 自定义 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#8b5cf6',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#06b6d4',
                        'dark-bg': '#111827',
                        'dark-card': '#1f2937',
                        'dark-input': '#374151',
                        'dark-border': '#4b5563',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-bg {
                transition: background-color 0.3s ease;
            }
            .transition-all-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .shadow-custom {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        }
    </style>
    <style>
        body {
            background-color: #111827;
            font-family: 'Inter', sans-serif;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        body.loaded {
            opacity: 1;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .hover-scale:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body class="text-gray-200 min-h-screen flex flex-col">
    <!-- 顶部导航 -->
    <header class="bg-dark-card shadow-md z-30 sticky top-0">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <i class="fa fa-question-circle-o text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-white">FAQ问答管理系统</h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="relative">
                    <input type="text" placeholder="全局搜索..." class="bg-dark-input border border-gray-700 rounded-lg px-4 py-2 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-primary w-64">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fa fa-bell-o text-gray-400 hover:text-white cursor-pointer transition-colors"></i>
                    <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center cursor-pointer hover:bg-primary/90 transition-colors">
                        <span class="font-medium text-white">用户</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-1 container mx-auto px-4 py-6">
        <!-- 面包屑导航 -->
        <nav class="mb-6 text-sm">
            <ol class="flex items-center gap-2">
                <li><a href="/" class="text-gray-400 hover:text-primary transition-colors">首页</a></li>
                <li><i class="fa fa-chevron-right text-xs text-gray-500"></i></li>
                <li><a href="/module/{{ level1_id }}" class="text-gray-400 hover:text-primary transition-colors">{{ level1_name }}</a></li>
                <li><i class="fa fa-chevron-right text-xs text-gray-500"></i></li>
                <li><span class="text-primary font-medium">FAQ问答</span></li>
            </ol>
        </nav>

        <!-- 页面标题和操作按钮 -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
            <div>
                <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white mb-1">FAQ问答管理</h2>
                <p class="text-gray-400">管理和维护系统中的FAQ问答内容及相关配置</p>
            </div>
            <div class="flex gap-3 w-full sm:w-auto flex-wrap">
                <button id="import-faq-btn" class="px-4 py-2 bg-secondary hover:bg-secondary/90 text-white rounded-lg transition-all-custom flex items-center justify-center gap-2 flex-1 sm:flex-none">
                    <i class="fa fa-upload"></i>导入Excel
                </button>
                <button id="export-faq-btn" class="px-4 py-2 bg-accent hover:bg-accent/90 text-white rounded-lg transition-all-custom flex items-center justify-center gap-2 flex-1 sm:flex-none">
                    <i class="fa fa-download"></i>导出Excel
                </button>
                <button id="add-faq-btn" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-all-custom flex items-center justify-center gap-2 flex-1 sm:flex-none">
                    <i class="fa fa-plus"></i>新增问答
                </button>
            </div>
        </div>

        <!-- 多级目录和筛选 -->
        <div class="bg-dark-card rounded-lg p-4 mb-6 shadow-custom hover-scale transition-all-custom">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- 多级目录 -->
                <div class="w-full lg:w-1/3">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-medium text-lg text-white">目录导航</h3>
                        <button id="manage-categories-btn" class="text-sm text-primary hover:text-primary/80 transition-colors">管理目录</button>
                    </div>
                    <div class="bg-dark-bg rounded-lg p-3 max-h-80 overflow-y-auto scrollbar-hide">
                        <ul id="category-tree" class="space-y-1">
                            {% if category_data %}
                                {% for category in category_data %}
                                    <li class="category-item">
                                        <div class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-dark-card transition-colors cursor-pointer {{ 'bg-primary/20 text-primary' if category.id == current_category_id }}"
                                            onclick="switchCategory('{{ category.id }}')">
                                            <span class="flex items-center gap-2">{{ category.name }}</span>
                                            {% if category.children %}
                                                <i class="fa fa-angle-down text-xs transition-transform"></i>
                                            {% endif %}
                                        </div>
                                        {% if category.children %}
                                            <ul class="pl-6 space-y-1 mt-1">
                                                {% for sub_category in category.children %}
                                                    <li>
                                                        <div class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-dark-card transition-colors cursor-pointer {{ 'bg-primary/20 text-primary' if sub_category.id == current_sub_category_id }}"
                                                            onclick="switchSubCategory('{{ sub_category.id }}')">
                                                            <span>{{ sub_category.name }}</span>
                                                        </div>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li class="text-center py-6 text-gray-500">
                                    暂无目录数据
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>

                <!-- 筛选条件 -->
                <div class="w-full lg:w-2/3">
                    <div class="flex flex-wrap gap-4 items-center">
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-400 mb-1">FAQ状态</label>
                            <select id="faq-status-filter" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="all">全部状态</option>
                                <option value="active">已启用</option>
                                <option value="inactive">已禁用</option>
                                <option value="draft">草稿</option>
                            </select>
                        </div>
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-400 mb-1">模板状态</label>
                            <select id="faq-template-filter" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="all">全部</option>
                                <option value="template">是模板</option>
                                <option value="not_template">非模板</option>
                            </select>
                        </div>
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-400 mb-1">搜索问答</label>
                            <div class="relative">
                                <input type="text" id="faq-search-input" placeholder="搜索问题或答案..." class="w-full bg-dark-input border border-gray-700 rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-2 focus:ring-primary">
                                <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ列表 -->
        <div class="bg-dark-card rounded-lg shadow-custom overflow-hidden hover-scale transition-all-custom">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-dark-bg border-b border-gray-700 text-left">
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">问答ID</th>
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">问题</th>
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">分类</th>
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">状态</th>
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">模板</th>
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">创建时间</th>
                            <th class="px-6 py-4 text-sm font-semibold text-gray-400">操作</th>
                        </tr>
                    </thead>
                    <tbody id="faq-table-body">
                        {% if faq_data %}
                            {% for faq in faq_data %}
                                <tr class="data-row border-b border-gray-700 hover:bg-dark-bg/50 transition-colors">
                                    <td class="px-6 py-4 text-sm">{{ faq.id }}</td>
                                    <td class="px-6 py-4 text-sm max-w-xs truncate" title="{{ faq.question }}">{{ faq.question }}</td>
                                    <td class="px-6 py-4 text-sm">{{ faq.category }} / {{ faq.sub_category }}</td>
                                    <td class="px-6 py-4 text-sm">
                                        {% if faq.status == 'active' %}
                                            <span class="px-2 py-1 bg-green-500/20 text-green-500 rounded-full text-xs font-medium">已启用</span>
                                        {% elif faq.status == 'inactive' %}
                                            <span class="px-2 py-1 bg-red-500/20 text-red-500 rounded-full text-xs font-medium">已禁用</span>
                                        {% elif faq.status == 'draft' %}
                                            <span class="px-2 py-1 bg-yellow-500/20 text-yellow-500 rounded-full text-xs font-medium">草稿</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 text-sm">
                                        {% if faq.is_template %}
                                            <i class="fa fa-check text-green-500"></i>
                                        {% else %}
                                            <i class="fa fa-times text-gray-500"></i>
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-400">{{ faq.created_at }}</td>
                                    <td class="px-6 py-4 text-sm">
                                        <div class="flex gap-2">
                                            <button class="text-blue-500 hover:text-blue-400 transition-colors" title="查看详情" onclick="viewFaq('{{ faq.id }}')">
                                                <i class="fa fa-eye"></i>
                                            </button>
                                            <button class="text-yellow-500 hover:text-yellow-400 transition-colors" title="编辑问答" onclick="editFaq('{{ faq.id }}')">
                                                <i class="fa fa-pencil"></i>
                                            </button>
                                            <button class="text-green-500 hover:text-green-400 transition-colors" title="渠道答案管理" onclick="manageChannels('{{ faq.id }}')">
                                                <i class="fa fa-channels"></i>
                                            </button>
                                            <button class="text-purple-500 hover:text-purple-400 transition-colors" title="相似问管理" onclick="manageSimilarQuestions('{{ faq.id }}')">
                                                <i class="fa fa-sitemap"></i>
                                            </button>
                                            <button class="text-orange-500 hover:text-orange-400 transition-colors" title="关联问题设置" onclick="manageRelatedQuestions('{{ faq.id }}')">
                                                <i class="fa fa-link"></i>
                                            </button>
                                            <button class="text-red-500 hover:text-red-400 transition-colors" title="删除问答" onclick="deleteFaq('{{ faq.id }}')">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr id="noResults" class="text-center">
                                <td colspan="7" class="px-6 py-12 text-gray-500">
                                    <i class="fa fa-search text-4xl mb-3"></i>
                                    <p>未找到符合条件的问答数据</p>
                                    <button id="resetFilters" class="mt-3 px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors">
                                        重置筛选条件
                                    </button>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <!-- 分页 -->
            {% if faq_data and faq_data|length > 0 %}
                <div class="px-6 py-4 border-t border-gray-700 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="text-sm text-gray-400">
                        显示 {{ start_index }} 到 {{ end_index }} 条，共 {{ total_count }} 条记录
                    </div>
                    <div class="flex gap-1">
                        <button class="px-3 py-1 rounded border border-gray-700 hover:bg-dark-bg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" {% if current_page == 1 %}disabled{% endif %} onclick="goToPage(1)">
                            <i class="fa fa-angle-double-left"></i>
                        </button>
                        <button class="px-3 py-1 rounded border border-gray-700 hover:bg-dark-bg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" {% if current_page == 1 %}disabled{% endif %} onclick="goToPage(current_page - 1)">
                            <i class="fa fa-angle-left"></i>
                        </button>
                        {% for page in pages_to_show %}
                            <button class="px-3 py-1 rounded border {% if page == current_page %}border-primary bg-primary/20 text-primary{% else %}border-gray-700 hover:bg-dark-bg transition-colors{% endif %}" onclick="goToPage({{ page|default(0) }})">{{ page|default(0) }}</button>

                        {% endfor %}
                        <button class="px-3 py-1 rounded border border-gray-700 hover:bg-dark-bg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" {% if current_page == total_pages %}disabled{% endif %} onclick="goToPage(current_page + 1)">
                            <i class="fa fa-angle-right"></i>
                        </button>
                        <button class="px-3 py-1 rounded border border-gray-700 hover:bg-dark-bg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" {% if current_page == total_pages %}disabled{% endif %} onclick="goToPage(total_pages)">
                            <i class="fa fa-angle-double-right"></i>
                        </button>
                    </div>
                </div>
            {% endif %}
        </div>
    </main>

    <!-- 通用浮窗组件 -->
    <div id="modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
        <div class="bg-dark-card rounded-lg shadow-xl w-full max-w-2xl p-6 m-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2 sticky top-0 bg-dark-card z-10">
                <h3 id="modal-title" class="text-xl font-semibold text-white">功能浮窗</h3>
                <button id="close-modal" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div id="modal-content" class="text-gray-300 mb-6">
                <!-- 浮窗内容将通过JavaScript动态插入 -->
            </div>
            <div class="flex justify-end gap-3 sticky bottom-0 bg-dark-card pt-4 border-t border-gray-700 z-10">
                <button id="cancel-modal" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">取消</button>
                <button id="confirm-modal" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors">确认</button>
            </div>
        </div>
    </div>

    <script>
        // 浮窗控制函数
        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
            document.body.classList.add('overflow-hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
            document.body.classList.remove('overflow-hidden');
        }

        // 目录切换函数
        function switchCategory(categoryId) {
            // 这里应该执行目录切换的AJAX请求
            location.reload(); // 临时刷新页面
        }

        function switchSubCategory(subCategoryId) {
            // 这里应该执行子目录切换的AJAX请求
            location.reload(); // 临时刷新页面
        }

        // FAQ操作函数
        function viewFaq(faqId) {
            showModal('FAQ详情', `
                <div class="space-y-6">
                    <div class="p-4 bg-dark-bg rounded-lg">
                        <h4 class="font-medium text-lg mb-3 text-white">基本信息</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">问答ID</p>
                                <p class="font-medium" id="detail-id">${faqId}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400 mb-1">分类</p>
                                <p class="font-medium" id="detail-category"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400 mb-1">状态</p>
                                <p class="font-medium" id="detail-status"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400 mb-1">模板</p>
                                <p class="font-medium" id="detail-template"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400 mb-1">创建时间</p>
                                <p class="font-medium" id="detail-created"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400 mb-1">更新时间</p>
                                <p class="font-medium" id="detail-updated"></p>
                            </div>
                        </div>
                    </div>
                     
                    <div class="p-4 bg-dark-bg rounded-lg">
                        <h4 class="font-medium text-lg mb-3 text-white">问题</h4>
                        <p id="detail-question" class="whitespace-pre-line"></p>
                    </div>
                     
                    <div class="p-4 bg-dark-bg rounded-lg">
                        <h4 class="font-medium text-lg mb-3 text-white">标准答案</h4>
                        <p id="detail-answer" class="whitespace-pre-line"></p>
                    </div>
                     
                    <div class="p-4 bg-dark-bg rounded-lg">
                        <h4 class="font-medium text-lg mb-3 text-white">多渠道答案</h4>
                        <div id="detail-channels" class="space-y-3"></div>
                    </div>
                     
                    <div class="p-4 bg-dark-bg rounded-lg">
                        <h4 class="font-medium text-lg mb-3 text-white">相似问题</h4>
                        <div id="detail-similar-questions" class="space-y-2"></div>
                    </div>
                     
                    <div class="p-4 bg-dark-bg rounded-lg">
                        <h4 class="font-medium text-lg mb-3 text-white">关联问题</h4>
                        <div id="detail-related-questions" class="space-y-2"></div>
                    </div>
                </div>
            `);
            // 这里应该通过AJAX获取FAQ详情数据并填充
        }

        function editFaq(faqId) {
            showModal('编辑FAQ', `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">分类 <span class="text-red-500">*</span></label>
                            <select id="edit-category" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                {% if category_data %}
                                    {% for category in category_data %}
                                        <option value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">子分类 <span class="text-red-500">*</span></label>
                            <select id="edit-sub-category" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                <!-- 子分类选项将通过JavaScript动态加载 -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">状态 <span class="text-red-500">*</span></label>
                            <select id="edit-status" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="active">已启用</option>
                                <option value="inactive">已禁用</option>
                                <option value="draft">草稿</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">是否为模板</label>
                            <div class="flex items-center mt-1">
                                <input type="checkbox" id="edit-is-template" class="w-4 h-4 text-primary focus:ring-primary border-gray-700 rounded">
                                <label for="edit-is-template" class="ml-2 text-sm text-gray-300">设为模板</label>
                            </div>
                        </div>
                    </div>
                     
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">问题 <span class="text-red-500">*</span></label>
                        <textarea id="edit-question" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary h-24"></textarea>
                    </div>
                     
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">标准答案 <span class="text-red-500">*</span></label>
                        <textarea id="edit-answer" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary h-32"></textarea>
                    </div>
                </div>
            `);
            // 这里应该通过AJAX获取FAQ数据并填充表单
            // 覆盖确认按钮事件
            document.getElementById('confirm-modal').onclick = function() {
                // 这里应该执行编辑FAQ操作
                closeModal();
            };
        }

        function manageChannels(faqId) {
            showModal('渠道答案管理', `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="font-medium text-lg text-white">多渠道答案</h4>
                        <button id="add-channel-btn" class="px-3 py-1 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors text-sm flex items-center gap-1">
                            <i class="fa fa-plus"></i>添加渠道
                        </button>
                    </div>
                     
                    <div id="channels-list" class="space-y-4">
                        <!-- 渠道答案将通过AJAX加载 -->
                        <div class="col-span-full text-center py-8 text-gray-500">加载中...</div>
                    </div>
                </div>
            `);
            // 这里应该通过AJAX获取渠道答案数据
        }

        function manageSimilarQuestions(faqId) {
            showModal('相似问管理', `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="font-medium text-lg text-white">相似问题</h4>
                        <button id="add-similar-btn" class="px-3 py-1 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors text-sm flex items-center gap-1">
                            <i class="fa fa-plus"></i>添加相似问
                        </button>
                    </div>
                     
                    <div id="similar-questions-list" class="space-y-3">
                        <!-- 相似问题将通过AJAX加载 -->
                        <div class="col-span-full text-center py-8 text-gray-500">加载中...</div>
                    </div>
                </div>
            `);
            // 这里应该通过AJAX获取相似问题数据
        }

        function manageRelatedQuestions(faqId) {
            showModal('关联问题设置', `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="font-medium text-lg text-white">关联问题</h4>
                        <button id="add-related-btn" class="px-3 py-1 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors text-sm flex items-center gap-1">
                            <i class="fa fa-plus"></i>添加关联问题
                        </button>
                    </div>
                     
                    <div id="related-questions-list" class="space-y-3">
                        <!-- 关联问题将通过AJAX加载 -->
                        <div class="col-span-full text-center py-8 text-gray-500">加载中...</div>
                    </div>
                </div>
            `);
            // 这里应该通过AJAX获取关联问题数据
        }

        function deleteFaq(faqId) {
            showModal('确认删除', `
                <div class="space-y-4">
                    <div class="flex items-center gap-3 p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                        <i class="fa fa-exclamation-triangle text-red-500 text-xl"></i>
                        <p class="text-red-400">您确定要删除此FAQ问答吗？此操作不可撤销。</p>
                    </div>
                    <p>问答ID: <span class="font-medium text-primary">${faqId}</span></p>
                    <p class="text-sm text-gray-400">删除此问答会同时删除其关联的渠道答案、相似问题和关联问题数据。</p>
                </div>
            `);
            // 覆盖确认按钮事件
            document.getElementById('confirm-modal').onclick = function() {
                // 这里应该执行删除操作的AJAX请求
                closeModal();
            };
        }

        // 导入导出函数
        document.getElementById('import-faq-btn').addEventListener('click', function() {
            showModal('导入FAQ', `
                <div class="space-y-4">
                    <p>请选择Excel文件进行导入。文件格式请参考<a href="#" class="text-primary hover:underline">导入模板</a>。</p>
                    <div class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-primary transition-colors cursor-pointer">
                        <input type="file" id="import-file" accept=".xlsx, .xls" class="hidden">
                        <label for="import-file" class="cursor-pointer">
                            <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-3"></i>
                            <p class="text-gray-400 mb-1">拖放文件到此处或</p>
                            <p class="text-primary font-medium">选择文件</p>
                        </label>
                    </div>
                    <div id="file-info" class="hidden p-3 bg-dark-bg rounded-lg"></div>
                </div>
            `);
            // 覆盖确认按钮事件
            document.getElementById('confirm-modal').onclick = function() {
                // 这里应该执行导入操作
                closeModal();
            };
        });

        document.getElementById('export-faq-btn').addEventListener('click', function() {
            showModal('导出FAQ', `
                <div class="space-y-4">
                    <p>请选择导出选项：</p>
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <input type="radio" id="export-all" name="export-option" value="all" checked class="mr-2 text-primary focus:ring-primary h-4 w-4">
                            <label for="export-all">导出所有问答</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="export-selected" name="export-option" value="selected" class="mr-2 text-primary focus:ring-primary h-4 w-4">
                            <label for="export-selected">导出当前筛选结果</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="export-category" name="export-option" value="category" class="mr-2 text-primary focus:ring-primary h-4 w-4">
                            <label for="export-category">按分类导出</label>
                            <select id="export-category-select" class="ml-2 bg-dark-input border border-gray-700 text-white rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-primary hidden">
                                {% if category_data %}
                                    {% for category in category_data %}
                                        <option value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                    </div>
                </div>
            `);
            // 显示/隐藏分类选择框
            document.querySelectorAll('input[name="export-option"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('export-category-select').classList.toggle('hidden', this.value !== 'category');
                });
            });
            // 覆盖确认按钮事件
            document.getElementById('confirm-modal').onclick = function() {
                // 这里应该执行导出操作
                closeModal();
            };
        });

        // 新增FAQ按钮事件
        document.getElementById('add-faq-btn').addEventListener('click', function() {
            showModal('新增FAQ', `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">分类 <span class="text-red-500">*</span></label>
                            <select id="new-category" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                {% if category_data %}
                                    {% for category in category_data %}
                                        <option value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">子分类 <span class="text-red-500">*</span></label>
                            <select id="new-sub-category" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                <!-- 子分类选项将通过JavaScript动态加载 -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">状态 <span class="text-red-500">*</span></label>
                            <select id="new-status" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="active">已启用</option>
                                <option value="inactive">已禁用</option>
                                <option value="draft">草稿</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">是否为模板</label>
                            <div class="flex items-center mt-1">
                                <input type="checkbox" id="new-is-template" class="w-4 h-4 text-primary focus:ring-primary border-gray-700 rounded">
                                <label for="new-is-template" class="ml-2 text-sm text-gray-300">设为模板</label>
                            </div>
                        </div>
                    </div>
                     
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">问题 <span class="text-red-500">*</span></label>
                        <textarea id="new-question" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary h-24"></textarea>
                    </div>
                     
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">标准答案 <span class="text-red-500">*</span></label>
                        <textarea id="new-answer" class="w-full bg-dark-input border border-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary h-32"></textarea>
                    </div>
                </div>
            `);
            // 覆盖确认按钮事件
            document.getElementById('confirm-modal').onclick = function() {
                // 这里应该执行新增FAQ操作
                closeModal();
            };
        });

        // 管理目录按钮事件
        document.getElementById('manage-categories-btn').addEventListener('click', function() {
            showModal('目录管理', `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="font-medium text-lg text-white">多级目录管理</h4>
                        <button id="add-category-btn" class="px-3 py-1 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors text-sm flex items-center gap-1">
                            <i class="fa fa-plus"></i>添加分类
                        </button>
                    </div>
                     
                    <div id="categories-management" class="space-y-4">
                        <!-- 目录管理内容将通过AJAX加载 -->
                        <div class="col-span-full text-center py-8 text-gray-500">加载中...</div>
                    </div>
                </div>
            `);
            // 这里应该通过AJAX获取目录数据
        });

        // 搜索和过滤功能
        // 添加分页函数定义
        function goToPage(pageNum) {
            console.log('Going to page:', pageNum);
            // 实现分页逻辑
            window.location.href = `?page=${pageNum}`;
        }

        // 添加关闭浮窗函数定义
        function closeModal() {
            const modal = document.getElementById('modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('faq-search-input');
            const statusFilter = document.getElementById('faq-status-filter');
            const templateFilter = document.getElementById('faq-template-filter');
            const dataRows = document.querySelectorAll('.data-row');
            const noResults = document.getElementById('noResults');

            // 添加防抖处理
            function debounce(func, delay) {
                let timeout;
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            }

            function filterFaqs() {
                const searchTerm = searchInput.value.toLowerCase();
                const statusValue = statusFilter.value;
                const templateValue = templateFilter.value;
                let hasVisibleRows = false;

                dataRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    let matchesSearch = false;
                    let matchesStatus = true;
                    let matchesTemplate = true;

                    // 检查是否匹配搜索词
                    cells.forEach(cell => {
                        if (cell.textContent.toLowerCase().includes(searchTerm)) {
                            matchesSearch = true;
                        }
                    });

                    // 检查是否匹配状态筛选
                    if (statusValue !== 'all') {
                        const statusCell = row.querySelector('td:nth-child(4) span');
                        if (statusCell) {
                            const cellText = statusCell.textContent;
                            if ((statusValue === 'active' && !cellText.includes('已启用')) ||
                                (statusValue === 'inactive' && !cellText.includes('已禁用')) ||
                                (statusValue === 'draft' && !cellText.includes('草稿'))) {
                                matchesStatus = false;
                            }
                        } else {
                            matchesStatus = false;
                        }
                    }

                    // 检查是否匹配模板筛选
                    if (templateValue !== 'all') {
                        const templateCell = row.querySelector('td:nth-child(5) i');
                        if (templateCell) {
                            if ((templateValue === 'template' && templateCell.classList.contains('fa-times')) ||
                                (templateValue === 'not_template' && templateCell.classList.contains('fa-check'))) {
                                matchesTemplate = false;
                            }
                        } else {
                            matchesTemplate = false;
                        }
                    }

                    // 显示或隐藏行
                    if (matchesSearch && matchesStatus && matchesTemplate) {
                        row.style.display = '';
                        hasVisibleRows = true;
                    } else {
                        row.style.display = 'none';
                    }
                });

                // 显示或隐藏无结果提示
                if (noResults) {
                    noResults.style.display = hasVisibleRows ? 'none' : 'block';
                }
            }

            const debouncedFilterFaqs = debounce(filterFaqs, 300);
            searchInput.addEventListener('input', debouncedFilterFaqs);
            statusFilter.addEventListener('change', filterFaqs);
            templateFilter.addEventListener('change', filterFaqs);

            // 重置筛选条件
            if (document.getElementById('resetFilters')) {
                document.getElementById('resetFilters').addEventListener('click', function() {
                    searchInput.value = '';
                    statusFilter.value = 'all';
                    templateFilter.value = 'all';
                    filterFaqs();
                });
            }

            // 初始化时执行一次过滤
            filterFaqs();

            // 关闭浮窗事件
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('cancel-modal').addEventListener('click', closeModal);
            document.getElementById('confirm-modal').addEventListener('click', closeModal);

            // 点击浮窗外部关闭
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // 页面加载动画
            setTimeout(() => {
                document.body.classList.add('loaded');
            }, 100);
        });
    </script>
</body>
</html>