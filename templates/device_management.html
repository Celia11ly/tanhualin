<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#4080FF',
                        success: '#00B42A',
                        warning: '#FF7D00',
                        danger: '#F53F3F',
                        info: '#86909C',
                        light: '#F2F3F5',
                        dark: '#1D2129',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .tab-active {
                @apply text-primary border-b-2 border-primary;
            }
            .btn {
                @apply px-4 py-2 rounded-md text-white font-medium transition-all duration-300;
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90;
            }
            .btn-danger {
                @apply bg-danger hover:bg-danger/90;
            }
            .btn-warning {
                @apply bg-warning hover:bg-warning/90;
            }
            .btn-info {
                @apply bg-info hover:bg-info/90;
            }
            .table-row {
                @apply border-b border-gray-200 hover:bg-gray-50 transition-colors duration-150;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 text-dark min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <button onclick="window.location.href='/'" class="btn btn-info flex items-center space-x-1 px-3 py-1.5 text-sm">
                    <i class="fa fa-home"></i>
                    <span>返回首页</span>
                </button>
                <h1 class="text-xl font-bold text-primary">设备管理系统</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <input type="text" placeholder="搜索设备..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary w-64">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <div class="relative">
                    <input type="date" class="pl-4 pr-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                    <i class="fa fa-calendar absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <button id="add-device-btn" class="btn btn-primary flex items-center space-x-2">
                    <i class="fa fa-plus"></i>
                    <span>添加设备</span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <!-- 选项卡导航 -->
            <div class="border-b border-gray-200 flex">
                <button id="tab-current" class="tab-active px-6 py-4 font-medium transition-all duration-300" onclick="switchTab('current')">
    当前设备
</button>
                <button id="tab-properties" class="px-6 py-4 font-medium text-gray-500 hover:text-primary transition-all duration-300" onclick="switchTab('properties')">
    设备属性
</button>
                <button id="tab-alerts" class="px-6 py-4 font-medium text-gray-500 hover:text-primary transition-all duration-300" onclick="switchTab('alerts')">
    告警日志
</button>
            </div>

            <!-- 当前设备选项卡 -->
            <div id="content-current" class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold">当前设备</h2>
                    <div class="flex space-x-3">
                        <button class="btn btn-primary flex items-center space-x-1 px-3 py-1.5 text-sm">
                            <i class="fa fa-plus"></i>
                            <span>Add</span>
                        </button>
                        <button class="btn btn-danger flex items-center space-x-1 px-3 py-1.5 text-sm" id="batch-delete">
                            <i class="fa fa-trash"></i>
                            <span>批量删除</span>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    <input type="checkbox" id="select-all" class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary">
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">设备名称</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">设备ID</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP地址</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">固件版本</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody id="device-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 动态生成的设备列表将在这里插入 -->
                        </tbody>
                        <script>
                            // 演示数据 - 使用编号替换中文名称
                            const devices = [
                { id: 1, deviceId: 'DVC-2023-001', name: '温度传感器', ip: '192.168.1.101', status: 'online', firmware: 'v1.2.3' },
                { id: 2, deviceId: 'DVC-2023-002', name: '湿度检测器', ip: '192.168.1.102', status: 'online', firmware: 'v1.2.3' },
                { id: 3, deviceId: 'DVC-2023-003', name: '智能开关', ip: '192.168.1.103', status: 'offline', firmware: 'v1.2.2' },
                { id: 4, deviceId: 'DVC-2023-004', name: '安全摄像头', ip: '192.168.1.104', status: 'online', firmware: 'v1.2.3' },
                { id: 5, deviceId: 'DVC-2023-005', name: '门禁系统', ip: '192.168.1.105', status: 'warning', firmware: 'v1.2.3' },
                { id: 6, deviceId: 'DVC-2023-006', name: '烟雾报警器', ip: '192.168.1.106', status: 'online', firmware: 'v1.2.3' },
                { id: 7, deviceId: 'DVC-2023-007', name: '智能电表', ip: '192.168.1.107', status: 'offline', firmware: 'v1.2.1' },
                { id: 8, deviceId: 'DVC-2023-008', name: '水质监测器', ip: '192.168.1.108', status: 'online', firmware: 'v1.2.3' },
                { id: 9, deviceId: 'DVC-2023-009', name: '光照传感器', ip: '192.168.1.109', status: 'online', firmware: 'v1.2.3' },
                { id: 10, deviceId: 'DVC-2023-010', name: '二氧化碳检测器', ip: '192.168.1.110', status: 'warning', firmware: 'v1.2.3' }
            ];

                            // 渲染设备列表
                            function renderDeviceList() {
                                const tableBody = document.getElementById('device-table-body');
                                const totalDevices = document.getElementById('total-devices');

                                // 清空表格
                                tableBody.innerHTML = '';

                                // 更新设备总数
                                totalDevices.textContent = devices.length;

                                // 打印表头信息用于调试
                                const headerRow = document.querySelector('thead tr');
                                const headers = Array.from(headerRow.querySelectorAll('th')).map(th => th.textContent.trim());
                                console.log('表头列:', headers);

                                // 渲染每个设备行
                                devices.forEach((device, index) => {
                                    // 直接创建单元格，避免使用innerHTML可能导致的问题
                                    const row = document.createElement('tr');
                                    row.className = 'table-row';

                                    // 创建选择框单元格
                                    const checkboxCell = document.createElement('td');
                                    checkboxCell.className = 'px-6 py-4 whitespace-nowrap';
                                    const checkbox = document.createElement('input');
                                    checkbox.type = 'checkbox';
                                    checkbox.className = 'device-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary';
                                    checkbox.dataset.id = device.id;
                                    checkboxCell.appendChild(checkbox);
                                    row.appendChild(checkboxCell);

                                    // 创建设备名称单元格
                                    const nameCell = document.createElement('td');
                                    nameCell.className = 'px-6 py-4 whitespace-nowrap';
                                    nameCell.textContent = device.name;
                                    row.appendChild(nameCell);

                                    // 创建Device ID单元格
                                    const idCell = document.createElement('td');
                                    idCell.className = 'px-6 py-4 whitespace-nowrap';
                                    idCell.textContent = device.deviceId;
                                    row.appendChild(idCell);

                                    // 创建IP Address单元格
                                    const ipCell = document.createElement('td');
                                    ipCell.className = 'px-6 py-4 whitespace-nowrap';
                                    ipCell.textContent = device.ip;
                                    row.appendChild(ipCell);

                                    // 创建Status单元格
                                    const statusCell = document.createElement('td');
                                    statusCell.className = 'px-6 py-4 whitespace-nowrap';
                                    let statusClass = 'bg-gray-100 text-gray-800';
                                    let statusText = 'Offline';
                                    if (device.status === 'online') {
                                        statusClass = 'bg-success/10 text-success';
                                        statusText = 'Online';
                                    } else if (device.status === 'warning') {
                                        statusClass = 'bg-warning/10 text-warning';
                                        statusText = 'Warning';
                                    }
                                    const statusSpan = document.createElement('span');
                                    statusSpan.className = `px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}`;
                                    statusSpan.textContent = statusText;
                                    statusCell.appendChild(statusSpan);
                                    row.appendChild(statusCell);

                                    // 创建Firmware单元格
                                    const firmwareCell = document.createElement('td');
                                    firmwareCell.className = 'px-6 py-4 whitespace-nowrap';
                                    firmwareCell.textContent = device.firmware;
                                    row.appendChild(firmwareCell);

                                    // 创建Actions单元格
                                    const actionsCell = document.createElement('td');
                                    actionsCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium';

                                    const editButton = document.createElement('button');
                                    editButton.className = 'text-primary hover:text-primary/80 mr-3';
                                    editButton.textContent = '编辑';
                                    actionsCell.appendChild(editButton);

                                    const deleteButton = document.createElement('button');
                                    deleteButton.className = 'text-danger hover:text-danger/80';
                                    deleteButton.textContent = '删除';
                                    actionsCell.appendChild(deleteButton);

                                    row.appendChild(actionsCell);

                                    // 添加到表格
                                    tableBody.appendChild(row);

                                    // 调试信息
                                    console.log(`设备 ${index+1} 数据:`);
                                    console.log(`- Device ID: ${device.deviceId}`);
                                    console.log(`- IP: ${device.ip}`);
                                    console.log(`- Status: ${statusText}`);
                                    console.log(`- Firmware: ${device.firmware}`);
                                });

                                // 验证列数
                                const headerCount = headers.length;
                                const firstRowCellCount = document.querySelector('tbody tr')?.querySelectorAll('td').length || 0;
                                console.log(`表头列数: ${headerCount}, 数据列数: ${firstRowCellCount}`);

                                // 如果列数不匹配，显示警告
                                if (headerCount !== firstRowCellCount) {
                                    console.warn('警告: 表头列数与数据列数不匹配!');
                                }
                            }
                            // 页面加载完成后渲染设备列表
                            document.addEventListener('DOMContentLoaded', renderDeviceList);
                        </script>
                    </table>
                </div>
                <!-- 分页 -->
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm text-gray-500">显示 1-10 条，共 <span id="total-devices">0</span> 条记录</div>
                    <div class="flex space-x-1">
                        <button class="px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50">上一页</button>
                        <button class="px-3 py-1 border border-primary bg-primary text-white rounded">1</button>
                        <button class="px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50">2</button>
                        <button class="px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50">下一页</button>
                    </div>
                </div>
            </div>

            <!-- 设备属性选项卡 -->
            <div id="content-properties" class="p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold">设备属性</h2>
                    <div>
                        <select class="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary mr-3">
                            <option>最近24小时</option>
                            <option>最近7天</option>
                            <option>最近30天</option>
                            <option>最近90天</option>
                        </select>
                        <button class="btn btn-primary flex items-center space-x-1 px-3 py-1.5 text-sm" id="firmware-upgrade">
                            <i class="fa fa-refresh"></i>
                            <span>固件升级</span>
                        </button>
                    </div>
                </div>
                <div id="device-properties-container"></div>
            </div>

            <!-- 告警日志选项卡 -->
            <div id="content-alerts" class="p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold">告警日志</h2>
                    <div class="flex space-x-3">
                        <button class="btn btn-info flex items-center space-x-1 px-3 py-1.5 text-sm">
                            <i class="fa fa-download"></i>
                            <span>导出日志</span>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">告警时间</th>
            
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">设备ID</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">严重程度</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">详细信息</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                            </tr>
                        </thead>
                        <tbody id="alerts-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <!-- 分页 -->
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm text-gray-500">显示 1-10 条，共 <span id="total-alerts">0</span> 条记录</div>
                    <div class="flex space-x-1">
                        <button class="px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50">上一页</button>
                        <button class="px-3 py-1 border border-primary bg-primary text-white rounded">1</button>
                        <button class="px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50">2</button>
                        <button class="px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50">下一页</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-4 mt-6">
        <div class="container mx-auto px-4 text-center text-sm text-gray-500">
            © 2023 设备管理系统 - 保留所有权利
        </div>
    </footer>

    <!-- 添加/编辑设备模态框 -->
    <div id="device-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="modal-title">添加设备</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-500">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4 max-h-[70vh] overflow-y-auto">
                <form id="device-form">

                    <div class="mb-4">
                            <label for="device-name" class="block text-sm font-medium text-gray-700 mb-1">设备名称</label>
                            <input type="text" id="device-name" name="device-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                        </div>
                        <div class="mb-4">
                            <label for="device-id" class="block text-sm font-medium text-gray-700 mb-1">设备ID</label>
                            <input type="text" id="device-id" name="device-id" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required readonly>
                        </div>
                    <div class="mb-4">
                        <label for="device-ip" class="block text-sm font-medium text-gray-700 mb-1">IP地址</label>
                        <input type="text" id="device-ip" name="device-ip" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                    </div>
                    <div class="mb-4">
                        <label for="device-status" class="block text-sm font-medium text-gray-700 mb-1">状态</label>
                        <select id="device-status" name="device-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                            <option value="online">在线</option>
                            <option value="offline">离线</option>
                            <option value="disabled">禁用</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="device-firmware" class="block text-sm font-medium text-gray-700 mb-1">固件版本</label>
                        <input type="text" id="device-firmware" name="device-firmware" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                    </div>
                    <div class="mb-4" id="edit-device-properties-container"></div>
                </form>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3">
                <button onclick="closeModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">取消</button>
                <button onclick="saveDevice()" class="btn btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 固件升级模态框 -->
    <div id="firmware-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="firmware-modal-content">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-bold">固件升级</h3>
                <button onclick="closeFirmwareModal()" class="text-gray-400 hover:text-gray-500">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4 max-h-[70vh] overflow-y-auto">
                <form id="firmware-form">
                    <div class="mb-4">
                        <label for="firmware-version" class="block text-sm font-medium text-gray-700 mb-1">选择固件版本</label>
                        <select id="firmware-version" name="firmware-version" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                            <option value="v1.2.3">v1.2.3 (最新版本)</option>
                            <option value="v1.2.2">v1.2.2</option>
                            <option value="v1.2.1">v1.2.1</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">升级说明</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" rows="3" readonly>1. 修复了设备连接不稳定的问题
2. 优化了数据传输效率
3. 增加了新的设备监控功能</textarea>
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary" required>
                            <span class="ml-2 text-sm text-gray-700">我已阅读并同意升级固件，了解升级可能需要设备重启</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3">
                <button onclick="closeFirmwareModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">取消</button>
                <button onclick="upgradeFirmware()" class="btn btn-primary">确认升级</button>
            </div>
        </div>
    </div>

    <script>
        // 当前选中的设备ID
        let selectedDeviceId = null;

        // 切换选项卡
        function switchTab(tabName) {
            // 隐藏所有内容
            document.getElementById('content-current').classList.add('hidden');
            document.getElementById('content-properties').classList.add('hidden');
            document.getElementById('content-alerts').classList.add('hidden');

            // 移除所有选项卡的活动状态
            document.getElementById('tab-current').classList.remove('tab-active');
            document.getElementById('tab-properties').classList.remove('tab-active');
            document.getElementById('tab-alerts').classList.remove('tab-active');
            document.getElementById('tab-current').classList.add('text-gray-500');
            document.getElementById('tab-properties').classList.add('text-gray-500');
            document.getElementById('tab-alerts').classList.add('text-gray-500');

            // 显示选中的内容
            document.getElementById(`content-${tabName}`).classList.remove('hidden');

            // 设置选项卡活动状态
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
            document.getElementById(`tab-${tabName}`).classList.remove('text-gray-500');

            // 如果切换到设备属性或告警日志，加载相应数据
            if (tabName === 'properties') {
                loadDeviceProperties();
            } else if (tabName === 'alerts') {
                loadAlertLogs();
            }
        }

        // 生成随机设备ID
        function generateDeviceId() {
            return 'DEV-' + Math.random().toString(36).substring(2, 10).toUpperCase();
        }

        // 打开添加设备模态框
        function openAddDeviceModal() {
            document.getElementById('modal-title').textContent = '添加设备';
            document.getElementById('device-id').value = generateDeviceId();
            document.getElementById('device-form').reset();
            document.getElementById('device-id').value = generateDeviceId();
            document.getElementById('device-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
                document.getElementById('modal-content').classList.add('scale-100', 'opacity-100');
            }, 10);
            selectedDeviceId = null;
        }

        // 打开编辑设备模态框
        function openEditDeviceModal(deviceId) {
            selectedDeviceId = deviceId;
            // 查找设备数据
            const devices = JSON.parse(localStorage.getItem('devices')) || [];
            const device = devices.find(d => d.id === deviceId);
            if (device) {
                document.getElementById('modal-title').textContent = 'Edit Device';
                    document.getElementById('device-id').value = device.id;
                document.getElementById('device-ip').value = device.ip;
                document.getElementById('device-status').value = device.status;
                document.getElementById('device-firmware').value = device.firmware;

                document.getElementById('device-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('modal-content').classList.add('scale-100', 'opacity-100');
                }, 10);
            }
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('modal-content').classList.remove('scale-100', 'opacity-100');
            document.getElementById('modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                document.getElementById('device-modal').classList.add('hidden');
            }, 300);
        }

        // 保存设备
        function saveDevice() {
            const deviceId = document.getElementById('device-id').value;
            const deviceIp = document.getElementById('device-ip').value;
            const deviceStatus = document.getElementById('device-status').value;
            const deviceFirmware = document.getElementById('device-firmware').value;

            const device = {
                id: deviceId,
                ip: deviceIp,
                status: deviceStatus,
                firmware: deviceFirmware,
                lastActive: new Date().toISOString()
            };

            let devices = JSON.parse(localStorage.getItem('devices')) || [];

            if (selectedDeviceId) {
                // 更新现有设备
                const index = devices.findIndex(d => d.id === selectedDeviceId);
                if (index !== -1) {
                    devices[index] = device;
                }
            } else {
                // 添加新设备
                devices.push(device);
            }

            localStorage.setItem('devices', JSON.stringify(devices));
            closeModal();
            loadDevices();

            // 显示成功提示
            showNotification(selectedDeviceId ? '设备更新成功' : '设备添加成功', 'success');
        }

        // 删除设备
        function deleteDevice(deviceId) {
            if (confirm('确定要删除此设备吗？')) {
                let devices = JSON.parse(localStorage.getItem('devices')) || [];
                devices = devices.filter(d => d.id !== deviceId);
                localStorage.setItem('devices', JSON.stringify(devices));
                loadDevices();
                showNotification('设备删除成功', 'success');
            }
        }

        // 批量删除设备
        document.getElementById('batch-delete').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#device-table-body input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                showNotification('请选择要删除的设备', 'warning');
                return;
            }

            if (confirm(`确定要删除选中的 ${checkboxes.length} 台设备吗？`)) {
                let devices = JSON.parse(localStorage.getItem('devices')) || [];
                checkboxes.forEach(checkbox => {
                    const deviceId = checkbox.getAttribute('data-id');
                    devices = devices.filter(d => d.id !== deviceId);
                });
                localStorage.setItem('devices', JSON.stringify(devices));
                loadDevices();
                showNotification(`${checkboxes.length} 台设备删除成功`, 'success');
            }
        });

        // 启用/禁用设备
        function toggleDeviceStatus(deviceId) {
            let devices = JSON.parse(localStorage.getItem('devices')) || [];
            const index = devices.findIndex(d => d.id === deviceId);
            if (index !== -1) {
                devices[index].status = devices[index].status === 'disabled' ? 'online' : 'disabled';
                localStorage.setItem('devices', JSON.stringify(devices));
                loadDevices();
                showNotification(`设备已${devices[index].status === 'disabled' ? '禁用' : '启用'}`, 'success');
            }
        }

        // 重启设备
        function rebootDevice(deviceId) {
            if (confirm('确定要重启此设备吗？')) {
                // 模拟重启操作
                showNotification('设备正在重启...', 'info');
                setTimeout(() => {
                    showNotification('设备重启成功', 'success');
                }, 2000);
            }
        }

        // 加载设备列表
        function loadDevices() {
            let devices = JSON.parse(localStorage.getItem('devices')) || [];

            // 如果没有设备，生成一些示例数据
            if (devices.length === 0) {
                devices = [
                    {
                        id: 'DEV-ABC123',
                        ip: '192.168.1.101',
                        status: 'online',
                        firmware: 'v1.2.3',
                        lastActive: new Date().toISOString()
                    },
                    {
                        id: 'DEV-DEF456',
                        ip: '192.168.1.102',
                        status: 'online',
                        firmware: 'v2.1.0',
                        lastActive: new Date().toISOString()
                    },
                    {
                        id: 'DEV-GHI789',
                        ip: '192.168.1.103',
                        status: 'offline',
                        firmware: 'v1.1.5',
                        lastActive: new Date(Date.now() - 3600000).toISOString()
                    },
                    {
                        id: 'DEV-JKL012',
                        ip: '192.168.1.104',
                        status: 'disabled',
                        firmware: 'v1.0.2',
                        lastActive: new Date(Date.now() - 86400000).toISOString()
                    },
                    {
                        id: 'DEV-MNO345',
                        ip: '192.168.1.105',
                        status: 'online',
                        firmware: 'v1.3.0',
                        lastActive: new Date().toISOString()
                    }
                ];
                localStorage.setItem('devices', JSON.stringify(devices));
            }

            const tableBody = document.getElementById('device-table-body');
            tableBody.innerHTML = '';

            devices.forEach(device => {
                const statusClass = device.status === 'online' ? 'text-success' : device.status === 'offline' ? 'text-warning' : 'text-gray-500';
                const statusText = device.status === 'online' ? '在线' : device.status === 'offline' ? '离线' : '已禁用';
                const statusIcon = device.status === 'online' ? 'fa-check-circle' : device.status === 'offline' ? 'fa-exclamation-circle' : 'fa-ban';
                const actionBtnText = device.status === 'disabled' ? '启用' : '禁用';
                const actionBtnClass = device.status === 'disabled' ? 'btn-success' : 'btn-warning';
                const actionBtnIcon = device.status === 'disabled' ? 'fa-check' : 'fa-ban';

                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" data-id="${device.id}" class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap font-medium">${device.name || '未命名设备'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${device.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${device.ip}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass}">
                        <i class="fa ${statusIcon} mr-1"></i>${statusText}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${device.firmware}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="openEditDeviceModal('${device.id}')" class="text-primary hover:text-primary/80 mr-3"><i class="fa fa-pencil"></i> 编辑</button>
                        <button onclick="toggleDeviceStatus('${device.id}')" class="text-${device.status === 'disabled' ? 'success' : 'warning'} hover:text-${device.status === 'disabled' ? 'success' : 'warning'}/80 mr-3"><i class="fa ${actionBtnIcon}"></i> ${actionBtnText}</button>
                        <button onclick="rebootDevice('${device.id}')" class="text-info hover:text-info/80 mr-3"><i class="fa fa-refresh"></i> 重启</button>
                        <button onclick="deleteDevice('${device.id}')" class="text-danger hover:text-danger/80"><i class="fa fa-trash"></i> 删除</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            document.getElementById('total-devices').textContent = devices.length;

            // 全选功能
            document.getElementById('select-all').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#device-table-body input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
        }

        // 加载设备属性
        function loadDeviceProperties() {
            const devices = JSON.parse(localStorage.getItem('devices')) || [];
            const container = document.getElementById('device-properties-container');
            container.innerHTML = '';

            if (devices.length === 0) {
                container.innerHTML = '<div class="text-center py-10 text-gray-500"><i class="fa fa-info-circle mr-2"></i>无可用设备数据</div>';
                return;
            }

            // 为每个设备创建属性卡片
            devices.forEach(device => {
                // 生成一些模拟属性数据
                const properties = [
                { name: '设备型号', value: 'Model ' + Math.floor(Math.random() * 1000) + 100 },
                { name: 'MAC地址', value: '00:1A:2B:3C:4D:' + Math.floor(Math.random() * 100).toString().padStart(2, '0') },
                { name: '连接方式', value: ['Wi-Fi', '以太网', '4G'][Math.floor(Math.random() * 3)] },
                { name: '信号强度', value: Math.floor(Math.random() * 100) + '%' },
                { name: '温度', value: Math.floor(Math.random() * 50) + '°C' },
                { name: '位置', value: ['客厅', '卧室', '厨房', '浴室', '办公室'][Math.floor(Math.random() * 5)] },
                { name: '最后活动时间', value: new Date(device.lastActive).toLocaleString() },
                { name: '运行时间', value: Math.floor(Math.random() * 10000) + '小时' }
            ];

                const card = document.createElement('div');
                card.className = 'border border-gray-200 rounded-lg p-4 mb-4';
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">${device.id}</h3>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${device.status === 'online' ? 'bg-success/10 text-success' : device.status === 'offline' ? 'bg-warning/10 text-warning' : 'bg-gray-100 text-gray-500'}">
                            ${device.status === 'online' ? 'Online' : device.status === 'offline' ? 'Offline' : 'Disabled'}
                        </span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        ${properties.map(prop => `
                            <div class="flex justify-between py-1 border-b border-gray-100">
                                <span class="text-gray-500">${prop.name}:</span>
                                <span class="font-medium">${prop.value}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="flex justify-end">
                        <button class="btn btn-primary text-sm px-3 py-1" onclick="showDeviceDetails('${device.id}')">
                            查看详情
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // 显示设备详情
        function showDeviceDetails(deviceId) {
            // 这里可以实现显示设备详细信息的逻辑
            alert('显示设备 ' + deviceId + ' 的详情');
        }

        // 加载告警日志
        function loadAlertLogs() {
            let alerts = JSON.parse(localStorage.getItem('alerts')) || [];

            // 如果没有告警日志，生成一些示例数据
            if (alerts.length === 0) {
                const devices = JSON.parse(localStorage.getItem('devices')) || [];
                const alertTypes = [
                    { level: 'critical', text: '严重', class: 'text-danger' },
                    { level: 'warning', text: '警告', class: 'text-warning' },
                    { level: 'info', text: '信息', class: 'text-info' }
                ];
                const alertMessages = [
                    '设备断开连接',
                    '电压异常',
                    '温度过高',
                    '固件版本过低',
                    '内存使用率高',
                    '网络延迟高',
                    '设备已重启',
                    '配置更新失败'
                ];

                for (let i = 0; i < 10; i++) {
                    const device = devices[Math.floor(Math.random() * devices.length)] || { id: 'DEV-UNKNOWN' };
                    const alertType = alertTypes[Math.floor(Math.random() * alertTypes.length)];
                    const message = alertMessages[Math.floor(Math.random() * alertMessages.length)];
                    const now = new Date();
                    now.setMinutes(now.getMinutes() - Math.floor(Math.random() * 1440)); // 随机时间在过去24小时内

                    alerts.push({
                        id: 'ALERT-' + Math.random().toString(36).substring(2, 10).toUpperCase(),
                        deviceId: device.id,
                            time: now.toISOString(),
                        level: alertType.level,
                        levelText: alertType.text,
                        levelClass: alertType.class,
                        message: message,
                        status: Math.random() > 0.5 ? '已处理' : '待处理'
                    });
                }

                localStorage.setItem('alerts', JSON.stringify(alerts));
            }

            const tableBody = document.getElementById('alerts-table-body');
            tableBody.innerHTML = '';

            alerts.forEach(alert => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(alert.time).toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium text-gray-900">${alert.deviceName}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alert.deviceId}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${alert.levelClass}">${alert.levelText}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate" title="${alert.message}">${alert.message}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${alert.status === '已处理' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${alert.status}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            document.getElementById('total-alerts').textContent = alerts.length;
        }

        // 打开固件升级模态框
        document.getElementById('firmware-upgrade').addEventListener('click', function() {
            document.getElementById('firmware-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('firmware-modal-content').classList.remove('scale-95', 'opacity-0');
                document.getElementById('firmware-modal-content').classList.add('scale-100', 'opacity-100');
            }, 10);
        });

        // 关闭固件升级模态框
        function closeFirmwareModal() {
            document.getElementById('firmware-modal-content').classList.remove('scale-100', 'opacity-100');
            document.getElementById('firmware-modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                document.getElementById('firmware-modal').classList.add('hidden');
            }, 300);
        }

        // 升级固件
        function upgradeFirmware() {
            closeFirmwareModal();
            showNotification('固件更新已开始，设备完成后将重启', 'info');
            // 模拟升级过程
            setTimeout(() => {
                showNotification('固件更新成功', 'success');
                // 更新所有设备的固件版本
                let devices = JSON.parse(localStorage.getItem('devices')) || [];
                devices = devices.map(device => ({
                    ...device,
                    firmware: document.getElementById('firmware-version').value
                }));
                localStorage.setItem('devices', JSON.stringify(devices));
                loadDevices();
                loadDeviceProperties();
            }, 3000);
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const typeClass = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';

            notification.className = `fixed top-4 right-4 ${typeClass} text-white px-4 py-2 rounded-md shadow-lg flex items-center z-50 transform transition-all duration-300 translate-x-full`;
            notification.innerHTML = `
                <i class="fa ${icon} mr-2"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // 显示通知
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 10);

            // 自动关闭通知
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        //<!-- 添加设备按钮点击事件 -->
            document.getElementById('add-device-btn').addEventListener('click', openAddDeviceModal);

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadDevices();
        });
    </script>
</body>
</html>